# 8장 의존성 관리하기

객체 지향의 핵심 : 협력을 위해 필요한 의존성은 유지하면서도 변경을 방해하는 의존성은 제거하는 데 있다.

# 1 의존성 이해하기

- 의존성은 실행 시점과 구현 시점에 서로 다른 의미를 가진다.
- 두 요소 사이 의존성은 의존되는 요소가 변경될 때 의존하는 요소도 함께 변경될 수 있음을 의미한다.

## 의존성 전이

의존성은 함께 변경될 수 있는 '*가능성'*을 의미하기 때문에 모든 경우에 의존성이 전이되는 것은 아니다.

의존성이 실제로 전이될 지 여부는 변경의 방향과 캡슐화의 정도에 따라 달라진다.

## 런타임 의존성, 컴파일타임 의존성

런타임 의존성 → 객체 사이 의존성

컴파일타임 의존성 → 클래스 사이 의존성

ex> 코드 작성 시점의 Movie 클래스는 할인 정책을 구현한 두 클래스의 존재를 모르지만, 실행 시점의 Movie 객체는 두 클래스의 인스턴스와 협력할 수 있게 된다.

—> 유연하고 재사용 가능한 설계를 창조하기 위해서는 동일한 소스코드 구조(;컴파일타임)를 가지고 다양한 실행 구조를 만들 수 있어야 한다.

## 컨텍스트 독립성

클래스가 특정 문맥에 강하게 결합될수록 다른 문맥에서 사용하기는 더 어려워진다. 클래스가 사용될 특정 문맥에 대한 최소한의 가정만으로 이뤄져 있다면, 다른 문맥에서 재사용하기가 더 수월해진다.

## 의존성 해결하기

방법 3가지

- setter
- 객체 생성 시점 생성자
- 메서드 실행 시 인자 이용

매번 동일한 객체를 인자로 전달하고 있다면, 생성자 이용 방식이나 setter 이용해 의존성 지속적으로 유지하는 방식이 좋다.

# 2 유연한 설계

## 의존성과 결합도

- 문제는 의존성의 존재가 아니라 `의존성의 정도`다.
바람직하지 않은 ex> Movie가 특정 구체적 DiscountCondition과 의존하는 경우, Movie 재사용 힘듬!
    - 바람직한 의존성이 중요한다. 이는 재사용성과 관련이 있다. 어떤 의존성이 다양한 환경에서 재사용될 수 있다면 이는 바람직하다.
- 바람직한 의존성을 가리키는 세련된 용어 → `결합도`
    - 의존성이 바람직할 때, 느슨한/약한 결합도 라고 한다. Loose Coupling

## 지식이 결합을 낳는다

더 많이 알수록 많이 결합된다. 더 많이 알고 있다는 것은 더 적은 컨텍스트에서 재사용 가능하다는 것을 의미한다.

→ 결합도를 느슨하게 만들어야 하는데, 이에 대한 해결책은 **추상화**!

## 추상화에 의존하라

결합도의 정도

구체 클래스 의존성 > 추상 클래스 의존성 > 인터페이스 의존성

## 명시적인 의존성

의존성은 명시적으로 표현되어야 한다. 유연하고 재사용 가능한 설계란 퍼블릭 인터페이스를 통해 의존성이 명시적으로 드러나는 설계다.

## new는 해롭다

1 메시지에 대한 의존성 외의 모든 다른 의존성이 생겨, 불필요한 의존성 만든다.

2 인스턴스를 생성하기 위해 어떤 인자들이 필요하고 그 인자들을 어떤 순서로 사용하는지 정보 노출

3 인자로 사용되는 구체 클래스에 대한 의존성을 추가

→ 바람직한 방법 : (상속하거나 인터페이스 구현하는)다형성 인스턴스 생성하는 책임은 클래스 사용하는 클라이언트로 넘기고, 이 클래스는 다형성 인스턴스 사용하는 책임만 남긴다.

; **객체 생성 책임을 객체 내부가 아니라, 클라이언트로 옮기자!!**

## 가끔은 생성해도 무방하다 ; new

이 경우는 주로 협력하는 기본 객체를 설정하는 경우에 해당하며, 생성자를 체이닝하는 방법으로 해결가능하다.
(즉, 인자 적게 받은 생성자에서 또 다른 생성자를 호출하는 방식으로.)

## 표준 클래스에 대한 의존은 해롭지 않다

ex> List

## 컨텍스트 확장하기

Movie가 DiscountPolicy **추상화에 의존**, 생성자를 통해 DiscountPolicy에 대한 **의존성 명시적으로 드러내**고, new와 같이 구체 클래스를 직접적으로 **다뤄야 하는 책임을 Movie 외부로**.

## 조합 가능한 행동

유연하고 재사용 가능한 설계는 객체가 어떻게 하는지를 장황하게 나열하지 않고도 객체들의 조합을 통해 **무엇**을 하는지 표현하는 클래스들로 구성된다.

---

방법(how)이 아닌 목적(what)에 집중하여, 의존성 관리를 합시다!!